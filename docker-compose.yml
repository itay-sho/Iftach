services:
  iftach:
    build: .
    ports:
      - "${IFTACH_LISTEN_PORT}:${IFTACH_LISTEN_PORT}"
    environment:
      IFTACH_SIP_USER: ${IFTACH_SIP_USER}
      IFTACH_SIP_PASS: ${IFTACH_SIP_PASS}
      IFTACH_SIP_DOMAIN: ${IFTACH_SIP_DOMAIN}
      IFTACH_DESTINATION: ${IFTACH_DESTINATION}
      IFTACH_OUTGOING_NUMBER: ${IFTACH_OUTGOING_NUMBER}
      IFTACH_LISTEN_ADDRESS: ${IFTACH_LISTEN_ADDRESS}
      IFTACH_LISTEN_PORT: ${IFTACH_LISTEN_PORT}
    restart: unless-stopped

  cloudflared:
    build: ./cloudflared
    environment:
      CLOUDFLARE_TUNNEL_ID: ${CLOUDFLARE_TUNNEL_ID}
      CLOUDFLARE_TUNNEL_CREDENTIALS: ${CLOUDFLARE_TUNNEL_CREDENTIALS}
      CLOUDFLARE_TUNNEL_CREDENTIALS_B64: ${CLOUDFLARE_TUNNEL_CREDENTIALS_B64:-}
      CLOUDFLARE_TUNNEL_HOSTNAME: ${CLOUDFLARE_TUNNEL_HOSTNAME:-iftach.rizz.co.il}
      CLOUDFLARE_TUNNEL_SERVICE_URL: ${CLOUDFLARE_TUNNEL_SERVICE_URL:-http://iftach:8080}
    depends_on:
      - iftach
    restart: unless-stopped